<section class="card vocabulist-home">
  <div class="plugin-view-nav vocabulist-lang-tabs" aria-label="Language">
    @for (lang of languages(); track lang) {
      <button
        type="button"
        class="btn secondary"
        [class.active]="currentLanguage() === lang"
        (click)="setLanguage(lang)"
      >
        {{ languageLabel(lang) }}
      </button>
    }
    @if (currentLanguage(); as lang) {
      <a
        [routerLink]="['/plugins/vocabulist', 'practice']"
        [queryParams]="{ lang }"
        class="btn primary"
      >
        Practice
      </a>
    }
  </div>

  @if (currentLanguage(); as lang) {
    <h2 class="vocabulist-language-heading">{{ languageLabel(lang) }} — vocabulary</h2>
    <div class="vocabulist-filters-collapsible">
      <button
        type="button"
        class="vocabulist-filters-toggle btn secondary"
        (click)="toggleFilters()"
        [attr.aria-expanded]="filtersOpen()"
        aria-controls="vocabulist-filters-panel"
      >
        Filters
        @if (activeFilterCount() > 0) {
          <span class="vocabulist-filters-badge">({{ activeFilterCount() }})</span>
        }
        <span class="vocabulist-filters-chevron" [class.vocabulist-filters-chevron--open]="filtersOpen()" aria-hidden="true">▼</span>
      </button>
      <div
        id="vocabulist-filters-panel"
        class="vocabulist-filter-panel"
        [class.vocabulist-filter-panel--open]="filtersOpen()"
        [hidden]="!filtersOpen()"
      >
        <div class="vocabulist-filter">
          @if (allTags().length > 0) {
            <div class="vocabulist-filter-group">
              <span class="vocabulist-filter-label">Tags:</span>
              <div class="vocabulist-tag-multiselect">
                @for (tag of allTags(); track tag) {
                  <button
                    type="button"
                    class="vocabulist-tag-chip"
                    [class.vocabulist-tag-chip--selected]="isTagSelected(tag)"
                    (click)="toggleTag(tag)"
                  >
                    {{ tag }}
                  </button>
                }
              </div>
            </div>
          }
          @if (allGrammarTags().length > 0) {
            <div class="vocabulist-filter-group">
              <span class="vocabulist-filter-label">Grammar:</span>
              <div class="vocabulist-tag-multiselect">
                @for (gt of allGrammarTags(); track gt) {
                  <button
                    type="button"
                    class="vocabulist-tag-chip vocabulist-grammar-chip"
                    [class.vocabulist-tag-chip--selected]="isGrammarTagSelected(gt)"
                    (click)="toggleGrammarTag(gt)"
                  >
                    {{ gt }}
                  </button>
                }
              </div>
            </div>
          }
          <div class="vocabulist-filter-group vocabulist-search-field">
            <label class="vocabulist-filter-label" for="vocabulist-search-input">Search</label>
            <input
              id="vocabulist-search-input"
              type="search"
              class="form-input vocabulist-search"
              placeholder="Word or translation"
              [value]="searchQuery()"
              (input)="searchQuery.set($any($event.target).value)"
            />
          </div>
        </div>
      </div>
    </div>

    <ul class="vocabulist-word-list">
      @for (word of filteredWords(); track trackByWordId($index, word)) {
        <li class="vocabulist-word-row">
          <a
            [routerLink]="['/plugins/vocabulist', 'word', word.id]"
            [queryParams]="{ lang }"
            class="vocabulist-word-link"
          >
            <span class="vocabulist-word-name">{{ wordDisplay(word, lang) }}</span>
            <span class="vocabulist-word-translation">{{ word.translation }}</span>
            @if (word.topicTags.length) {
              <span class="vocabulist-word-tags">
                @for (tag of word.topicTags; track tag) {
                  <span class="vocabulist-tag">{{ tag }}</span>
                }
              </span>
            }
          </a>
          @if (word.grammarTags?.length) {
            <div class="vocabulist-word-grammar-tags">
              @for (gt of word.grammarTags; track gt) {
                <button
                  type="button"
                  class="vocabulist-tag-chip vocabulist-grammar-chip"
                  [class.vocabulist-tag-chip--selected]="isGrammarTagSelected(gt)"
                  (click)="toggleGrammarTag(gt); $event.stopPropagation()"
                >
                  {{ gt }}
                </button>
              }
            </div>
          }
        </li>
      }
      @if (filteredWords().length === 0) {
        <li class="vocabulist-empty">No words in this language yet. Import a Duolingo JSON in Settings (⚙️) or add words.</li>
      }
    </ul>
  } @else {
    <p class="hint">Select a language above to see its vocabulary list. Each language has its own list. To add a language or import words, open Settings (⚙️).</p>
  }
</section>
