<div class="my-profile-cards">
  <section class="card">
    <h2 class="card-title">Profile</h2>
  <div class="field">
    <label for="name">Display name</label>
    <input id="name" type="text" [ngModel]="name()" (ngModelChange)="name.set($event)" placeholder="Your name" />
  </div>
  <div class="field">
    <label>Emoji icon</label>
    <p class="hint">Click the icon to choose a different one.</p>
    <app-emoji-grid [value]="emoji()" (valueChange)="emoji.set($event)" />
  </div>
  <div class="field">
    <label>Theme</label>
    <div class="theme-toggle">
      <button type="button" class="btn secondary" [class.active]="theme() === 'light'" (click)="setTheme('light')">Light</button>
      <button type="button" class="btn secondary" [class.active]="theme() === 'dark'" (click)="setTheme('dark')">Dark</button>
      <button type="button" class="btn secondary" [class.active]="theme() === 'classic'" (click)="setTheme('classic')">Classic</button>
    </div>
  </div>
  </section>

  <section class="card">
    <h2 class="card-title">Visible plugins</h2>
  <p class="hint">Choose which apps appear in the sidebar. If none are selected, all are shown.</p>
  <div class="plugin-actions">
    <button type="button" class="btn secondary" (click)="selectAll()">Show all</button>
    <button type="button" class="btn secondary" (click)="selectNone()">Hide all</button>
  </div>
  <ul class="plugin-list">
    @for (plugin of plugins(); track plugin.id) {
      <li>
        <label class="checkbox-label">
          <input type="checkbox" [checked]="isSelected(plugin.id)" (change)="togglePlugin(plugin.id)" />
          <span>{{ plugin.name }}</span>
        </label>
      </li>
    }
  </ul>
  </section>

  <section class="card">
    <h2 class="card-title">Plugin order</h2>
    <p class="hint">Change the order of apps in the sidebar. Use the buttons to move items up or down.</p>
    <ul class="plugin-order-list" aria-label="Plugin order">
      @for (id of orderedPluginIds(); track id; let i = $index) {
        @if (getPluginById(id); as plugin) {
          <li class="plugin-order-row">
            <span class="plugin-order-name">{{ plugin.icon }} {{ plugin.name }}</span>
            <div class="plugin-order-actions">
              <button
                type="button"
                class="btn icon-btn"
                [disabled]="i === 0"
                (click)="movePlugin(i, -1)"
                title="Move up"
                [attr.aria-label]="'Move ' + plugin.name + ' up'"
              >
                ↑
              </button>
              <button
                type="button"
                class="btn icon-btn"
                [disabled]="i === orderedPluginIds().length - 1"
                (click)="movePlugin(i, 1)"
                title="Move down"
                [attr.aria-label]="'Move ' + plugin.name + ' down'"
              >
                ↓
              </button>
            </div>
          </li>
        }
      }
    </ul>
  </section>

  @if (connectedApps().length > 0) {
    <section class="card">
    <h2 class="card-title">Connected applications</h2>
    <p class="hint">These plugins have external API authorisation. Disconnect here or in the plugin’s settings.</p>
    <ul class="connected-apps-list">
      @for (appId of connectedApps(); track appId) {
        <li class="connected-app-item">
          <span class="connected-app-label">{{ getConnectedAppLabel(appId) }}</span>
          <button
            type="button"
            class="btn secondary btn-sm"
            (click)="disconnectApp(appId)"
            [disabled]="disconnectingAppId() === appId">
            {{ disconnectingAppId() === appId ? 'Disconnecting…' : 'Disconnect' }}
          </button>
        </li>
      }
    </ul>
    </section>
  }
</div>

<div class="actions">
  <button type="button" class="btn primary" (click)="save()" [disabled]="saveStatus() === 'saving'">
    @switch (saveStatus()) {
      @case ('saving') { Saving… }
      @case ('saved') { Saved }
      @default { Save }
    }
  </button>
  @if (saveStatus() === 'error') {
    <span class="error-msg">Save failed. Try again.</span>
  }
</div>
